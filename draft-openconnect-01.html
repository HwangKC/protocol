<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The OpenConnect VPN Protocol Version 1.0</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Terminology"/>
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Goals of This Document"/>
<link href="#rfc.section.2" rel="Chapter" title="2 The OpenConnect Protocol"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 VPN Session Establishment"/>
<link href="#rfc.section.2.1.1" rel="Chapter" title="2.1.1 Server Authentication"/>
<link href="#rfc.section.2.1.2" rel="Chapter" title="2.1.2 Client Authentication"/>
<link href="#rfc.section.2.1.3" rel="Chapter" title="2.1.3 Exchange of Session Parameters"/>
<link href="#rfc.section.2.1.4" rel="Chapter" title="2.1.4 Establishment of Primary TCP Channel (CSTP)"/>
<link href="#rfc.section.2.1.5" rel="Chapter" title="2.1.5 Establishment of Secondary UDP Channel (DTLS)"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 The CSTP Channel Protocol"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 The DTLS Channel Protocol"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 The Channel Re-Key Protocol"/>
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 The Keepalive and Dead Peer Detection Protocols"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Security Considerations"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="5 Normative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Name for Application-Layer Protocol Negotiation"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Compression"/>
<link href="#rfc.appendix.C" rel="Chapter" title="C DTD declarations"/>
<link href="#rfc.appendix.C.1" rel="Chapter" title="C.1 config-auth.dtd"/>


  <meta name="generator" content="xml2rfc version 2.4.8 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Mavrogiannopoulos, N." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-openconnect-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2015-5" />
  <meta name="dct.abstract" content="This document specifies version 1.0 of the OpenConnect Virtual Private Network (VPN) protocol, a secure VPN protocol that provides communications privacy over the Internet.  That protocol is believed to be compatible with CISCO's AnyConnect VPN protocol. The protocol allows the establishment of VPN tunnels in a way that is designed to prevent eavesdropping, tampering, or message forgery.  " />
  <meta name="description" content="This document specifies version 1.0 of the OpenConnect Virtual Private Network (VPN) protocol, a secure VPN protocol that provides communications privacy over the Internet.  That protocol is believed to be compatible with CISCO's AnyConnect VPN protocol. The protocol allows the establishment of VPN tunnels in a way that is designed to prevent eavesdropping, tampering, or message forgery.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">N. Mavrogiannopoulos</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Red Hat</td>
</tr>
<tr>
  <td class="left">Intended status: Historic</td>
  <td class="right">May 2015</td>
</tr>
<tr>
  <td class="left">Expires: November 2, 2015</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The OpenConnect VPN Protocol Version 1.0<br />
  <span class="filename">draft-openconnect-01</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document specifies version 1.0 of the OpenConnect Virtual Private Network (VPN) protocol, a secure VPN protocol that provides communications privacy over the Internet.  That protocol is believed to be compatible with CISCO's AnyConnect VPN protocol. The protocol allows the establishment of VPN tunnels in a way that is designed to prevent eavesdropping, tampering, or message forgery.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on November 2, 2015.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2015 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Terminology</a></li>
<li>1.2.   <a href="#rfc.section.1.2">Goals of This Document</a></li>
<li>2.   <a href="#rfc.section.2">The OpenConnect Protocol</a></li>
<li>2.1.   <a href="#rfc.section.2.1">VPN Session Establishment</a></li>
<li>2.1.1.   <a href="#rfc.section.2.1.1">Server Authentication</a></li>
<li>2.1.2.   <a href="#rfc.section.2.1.2">Client Authentication</a></li>
<li>2.1.3.   <a href="#rfc.section.2.1.3">Exchange of Session Parameters</a></li>
<li>2.1.4.   <a href="#rfc.section.2.1.4">Establishment of Primary TCP Channel (CSTP)</a></li>
<li>2.1.5.   <a href="#rfc.section.2.1.5">Establishment of Secondary UDP Channel (DTLS)</a></li>
<li>2.2.   <a href="#rfc.section.2.2">The CSTP Channel Protocol</a></li>
<li>2.3.   <a href="#rfc.section.2.3">The DTLS Channel Protocol</a></li>
<li>2.4.   <a href="#rfc.section.2.4">The Channel Re-Key Protocol</a></li>
<li>2.5.   <a href="#rfc.section.2.5">The Keepalive and Dead Peer Detection Protocols</a></li>
<li>3.   <a href="#rfc.section.3">Security Considerations</a></li>
<li>4.   <a href="#rfc.section.4">Acknowledgements</a></li>
<li>5.   <a href="#rfc.references">Normative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Name for Application-Layer Protocol Negotiation</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Compression</a></li>
<li>Appendix C.   <a href="#rfc.appendix.C">DTD declarations</a></li>
<li>C.1.   <a href="#rfc.appendix.C.1">config-auth.dtd</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">The purpose of this document is to specify the OpenConnect VPN protocol in a detail in order to allow for multiple interoperable implementations.  This is the protocol used by the OpenConnect client and server <a href="#OPENCONNECT-CLIENT">[OPENCONNECT-CLIENT]</a><a href="#OPENCONNECT-SERVER">[OPENCONNECT-SERVER]</a>, and is believed to be compatible with CISCO's AnyConnect protocol.  </p>
<p id="rfc.section.1.p.2">While there are many competing VPN protocol solutions, none of them was ever described in a publicly available document. Even open source VPN solutions have their source code as the primary description of their protocol. That allowed no easy study of each protocol's properties and weaknesses, and that is the secondary goal of this document, to describe a deployed TLS based <a href="#RFC5246">[RFC5246]</a> VPN protocol.  </p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Requirements Terminology</a></h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a> <a href="#goals-document" id="goals-document">Goals of This Document</a></h1>
<p id="rfc.section.1.2.p.1">The OpenConnect protocol version 1.0 specification is intended primarily for readers who will be implementing the protocol and those doing cryptographic analysis of it.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#oc-protocol" id="oc-protocol">The OpenConnect Protocol</a></h1>
<p id="rfc.section.2.p.1">The OpenConnect protocol combines the TLS protocol <a href="#RFC5246">[RFC5246]</a>, Datagram TLS protocol <a href="#RFC6347">[RFC6347]</a> and HTTP protocols <a href="#RFC2616">[RFC2616]</a> to provide an Internet-Layer VPN channel.  The channel is designed to operate using UDP packets, and fallback on TCP if that's not possible.  </p>
<p id="rfc.section.2.p.2">In brief the protocol initiates an HTTP over TLS connection on a known port, where client authentication is performed. After this step, the client initiates an HTTP CONNECT command to establish a VPN channel over TCP. A secondary VPN channel over UDP will be established using information provided by the server using HTTP headers. At that point the raw IP packets flow, over the VPN channels.  </p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#session-establishment" id="session-establishment">VPN Session Establishment</a></h1>
<p id="rfc.section.2.1.p.1">The client and server establish a TLS connection over a known port, typically over 443, the port used for HTTPS. The client SHOULD negotiate TLS 1.1 or later, and support the following TLS protocol extensions.  </p>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">Server Name Indication <a href="#RFC6066">[RFC6066]</a>: the client SHOULD provide the DNS name of the server in the TLS handshake.</dd>
  <dt></dt>
  <dd style="margin-left: 8">Application-Layer Protocol Negotiation <a href="#RFC7301">[RFC7301]</a>: the client MAY provide this protocol name. The protocol name to be used is defined in <a href="#alpn-name">Appendix A</a>.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.2.1.1"><a href="#rfc.section.2.1.1">2.1.1.</a> <a href="#server-authentication" id="server-authentication">Server Authentication</a></h1>
<p id="rfc.section.2.1.1.p.1">In the OpenConnect VPN protocol, the server is always authenticated using its certificate. Once a client establishes a TCP connection to the server's well known port, it initiates the TLS protocol.  In the first connection to the server, the client SHOULD verify the provided by the server certificate, and SHOULD store its public key for verification of subsequent sessions. Thus, subsequent sessions SHOULD check whether the server's key match the initial.  </p>
<p id="rfc.section.2.1.1.p.2">The server's identity in the certificate SHOULD be placed in the certificate's SubjectAlternativeName field, and unless a special profile is assumed, it will be of type DNSName.  </p>
<h1 id="rfc.section.2.1.2"><a href="#rfc.section.2.1.2">2.1.2.</a> <a href="#authentication" id="authentication">Client Authentication</a></h1>
<p id="rfc.section.2.1.2.p.1">The OpenConnect VPN protocol allows for the following types of client authentication, or combinations of them.  </p>

<ol>
  <li>Password: a user can authenticate itself using a password.</li>
  <li>Certificate: a user can authenticate itself using a PKIX certificate it possesses.</li>
  <li>HTTP SPNEGO: a user can authenticate itself using a Kerberos ticket, or any other mechanism supported by SPNEGO (i.e., GSSAPI).</li>
</ol>

<p> The server is authenticated to the client using a PKIX certificate presented during the TLS negotiation.  </p>
<p id="rfc.section.2.1.2.p.2">It is important to note that during the password and HTTP SPNEGO authentication methods, any headers allowed by the HTTP protocol can be present. In fact, there are legacy clients which assume that the server will keep a state using cookies, and send their username and password in different TLS and HTTP connections. This practice prevents the server from binding the TLS channel with the VPN session <a href="#RFC5056">[RFC5056]</a>, and is discouraged.  It is RECOMMENDED for clients to complete authentication in the same TLS session, and rely on TLS session resumption if reconnections to the server are needed.  </p>
<pre>
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;!DOCTYPE config-auth SYSTEM "config-auth.dtd"&gt;
    &lt;config-auth client="vpn" type="init"&gt;
        &lt;version who="vpn"&gt;v5.01&lt;/version&gt;
    &lt;/config-auth&gt;
  </pre>
<p id="rfc.section.2.1.2.p.3">After the TLS session is established the client irrespective of the supported authentication methods, should send an HTTP POST request on "/" with a config-auth XML structure of type 'init'. An example of its contents follow.  </p>
<p id="rfc.section.2.1.2.p.4">The precise DTD declarations for the contents of XML messages defined in this document are listed in <a href="#dtd-decl">Appendix C</a>. Also the HTTP Content-Type to be used for these XML structures MUST be 'text/xml'.  </p>
<h1 id="rfc.section.2.1.2.1"><a href="#rfc.section.2.1.2.1">2.1.2.1.</a> <a href="#authentication_cert" id="authentication_cert">Authentication using certificates</a></h1>
<p id="rfc.section.2.1.2.1.p.1">During the initial TLS protocol handshake the server may require a client certificate to be presented, depending on its configuration.  </p>
<p id="rfc.section.2.1.2.1.p.2">Because the client certificate is sent in the clear during the handshake it SHOULD NOT contain other identifying information other than a username, or a pseudonymus identifier. It is RECOMMENDED to place the user identifier in the DN field of the certificate, using the UID object identifier (0.9.2342.19200300.100.1.1) <a href="#RFC4519">[RFC4519]</a>.  </p>
<p id="rfc.section.2.1.2.1.p.3">After the TLS session is established and the the config-auth XML structure of type 'init' is sent, the server should send it reply. If the certificate sent by the client was successfully validated, it should reply using the HTTP response code 200, and the contents of the reply should be a config-auth XML structure of type 'complete', as follows.  </p>
<pre>
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;!DOCTYPE config-auth SYSTEM "config-auth.dtd"&gt;
    &lt;config-auth client="vpn" type="complete"&gt;
      &lt;version who="sg"&gt;0.1(1)&lt;/version&gt;
      &lt;auth id="success"&gt;
        &lt;title&gt;SSL VPN Service&lt;/title&gt;
      &lt;/auth&gt;
    &lt;/config-auth&gt;
  </pre>
<p/>
<p id="rfc.section.2.1.2.1.p.5">In that case the client should proceed to the establishment of the primary channel as in <a href="#primary-channel">Section 2.1.4</a>.  </p>
<h1 id="rfc.section.2.1.2.2"><a href="#rfc.section.2.1.2.2">2.1.2.2.</a> <a href="#authentication_pass" id="authentication_pass">Authentication using passwords</a></h1>
<pre>
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;!DOCTYPE auth SYSTEM "config-auth.dtd"&gt;
    &lt;config-auth client="vpn" type="auth-request"&gt;
        &lt;auth id="main"&gt;
            &lt;message&gt;Please enter your username&lt;/message&gt;
            &lt;form action="/auth" method="post"&gt;
                &lt;input label="Username:" name="username" type="text" /&gt;
            &lt;/form&gt;
        &lt;/auth&gt;
    &lt;/config-auth&gt;
  </pre>
<p id="rfc.section.2.1.2.2.p.1">After the TLS session is established and the the config-auth XML structure of type 'init' is sent, the server will reply using forms the client software should prompt the user to fill in. Its reply utilizes a config-auth XML structure of type 'auth-request'.  </p>
<pre>
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;!DOCTYPE auth SYSTEM "config-auth.dtd"&gt;
    &lt;config-auth client="vpn" type="auth-request"&gt;
      &lt;auth id="main"&gt;
        &lt;message&gt;Please enter your username&lt;/message&gt;
        &lt;form action="/auth" method="post"&gt;
            &lt;input label="Username:" name="username" type="text"/&gt;
            &lt;input label="Password:" name="password" type="password"/&gt;
        &lt;/form&gt;
      &lt;/auth&gt;
    &lt;/config-auth&gt;
  </pre>
<p id="rfc.section.2.1.2.2.p.2">The client may be asked to provide the information in separate forms as above, or may be asked combined as below.  </p>
<pre>
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;!DOCTYPE config-auth SYSTEM "config-auth.dtd"&gt;
    &lt;config-auth client="vpn" type="auth-reply"&gt;
        &lt;version who="vpn"&gt;v5.01&lt;/version&gt;
        &lt;auth&gt;&lt;username&gt;test&lt;/username&gt;
        &lt;/auth&gt;
    &lt;/config-auth&gt;  
  </pre>
<p id="rfc.section.2.1.2.2.p.3">The client software will then fill in the provided form and sent it back to the server using an HTTP POST on the location specified by the server (in the above examples it was "/auth"). The reply would then be of type 'auth-reply' as in the following example.  </p>
<p id="rfc.section.2.1.2.2.p.4">As mentioned above, the server may ask repeatedly for information until it believes the user is authenticated. For example, the server could present a second form asking for the password, after the username is provided, or ask for a second password if that is necessary. In these cases the server should respond with an HTTP 200 OK status code, and proceed sending its new request.  </p>
<p id="rfc.section.2.1.2.2.p.5">If client authentication fails, the server MUST respond with an HTTP 401 unauthorized status code. Otherwise, on successful authentication the server should reply with a 200 HTTP code and use the 'complete' config-auth XML structure as in <a href="#authentication_cert">Section 2.1.2.1</a>.  </p>
<p id="rfc.section.2.1.2.2.p.6">Note, that sending the username and password in different messages will reveal the length of them to a passive eavesdropper. For that is is RECOMMENDED for clients to use the 'X-Pad' HTTP header, which will contain arbitrary printable data to make the message length a multiple of 64 bytes.  </p>
<p id="rfc.section.2.1.2.2.p.7">An example session is shown in figure <a href="#example1">Figure 1</a>.</p>
<div id="rfc.figure.1"/>
<div id="example1"/>
<pre>
        ,-.                                                                   
        `-'                                                                   
        /|\                                                                   
         |                                ,------.          ,----------.      
        / \                               |Server|          |ServerDTLS|      
      Client                              `--+---'          `----+-----'      
        |     TLS handshake Client Hello     |                   |            
        | -----------------------------------&gt;                   |            
        |                                    |                   |            
        |       TLS handshake Finished       |                   |            
        | &lt;-----------------------------------                   |            
        |                                    |                   |            
        |     HTTP POST config-auth init     |  ,--------------------!.       
        | -----------------------------------&gt;  |This is an HTTP over|_\      
        |                                    |  |TLS session.          |      
        |                                    |  `----------------------'      
        |      config-auth auth-request      |                   |            
        | &lt;-----------------------------------                   |            
        |                                    |                   |            
        |  HTTP POST config-auth auth-reply  |                   |            
        | -----------------------------------&gt;                   |            
        |                                    |                   |            
        |        config-auth complete        |                   |            
        | &lt;-----------------------------------                   |            
        |                                    |                   |            
        |            HTTP CONNECT            |                   |            
        | -----------------------------------&gt;                   |            
        |                                    |                   |            
        |                                    |                   |            
        |            ===================================         |            
====================== CSTP VPN session is established =======================
        |            ===================================         |            
        |                                    |                   |            
        |                                    |  ,-------------------------!.  
        | TLS record packet with CSTP payload|  |These packets show       |_\ 
        | -----------------------------------&gt;  |that IP traffic can start  | 
        |                                    |  |prior to the DTLS channel  | 
        |                                    |  |establishment.             | 
        |                                    |  `---------------------------' 
        | TLS record packet with CSTP payload|                   |            
        | &lt;-----------------------------------                   |            
        |                                    |                   |            
        |               DTLS handshake Client Hello              |            
        |  - - - - - - - - - - - - - - - - - - - - - - - - - - - &gt;            
        |                                    |                   |            
        |                 DTLS handshake Finished                |            
        | &lt;- - - - - - - - - - - - - - - - - - - - - - - - - - - -            
        |                                    |                   |            
        |                                    |                   |            
        |            ===================================         |            
====================== DTLS VPN channel is established =======================
        |            ===================================         |            
        |                                    |                   |            
        |             DTLS record packet with payload            |            
        |  - - - - - - - - - - - - - - - - - - - - - - - - - - - &gt;            
        |                                    |                   |            
        |             DTLS record packet with payload            |            
        | &lt;- - - - - - - - - - - - - - - - - - - - - - - - - - - -            
      Client                              ,--+---.          ,----+-----.      
        ,-.                               |Server|          |ServerDTLS|      
        `-'                               `------'          `----------'      
        /|\                                                                   
         |                                                                    
        / \                                                                   
  </pre>
<p class="figure">Figure 1</p>
<p/>
<h1 id="rfc.section.2.1.2.3"><a href="#rfc.section.2.1.2.3">2.1.2.3.</a> <a href="#authentication_gssapi" id="authentication_gssapi">HTTP Authentication using SPNEGO</a></h1>
<p id="rfc.section.2.1.2.3.p.1">That type of authentication is performed using the HTTP SPNEGO protocol <a href="#RFC4559">[RFC4559]</a>, a method which is available using the Generic Security Service API <a href="#RFC2743">[RFC2743]</a>. The following approach is used to advertise the availability of the HTTP SPNEGO protocol by the client.  A client which supports the HTTP SPNEGO protocol, SHOULD indicate it using the following header on in its initial request to the server with the config-auth 'init' XML structure.  </p>
<pre>
    X-Support-HTTP-Auth: true
</pre>
<p/>
<p id="rfc.section.2.1.2.3.p.3">After that the server would report a "401 Unauthorized" status code and authentication would proceed as specified in the HTTP SPNEGO protocol.  The server may utilize the following header, to indicate that alternative authentication methods are available (e.g., with plain password), if authentication fails.  </p>
<pre>
    X-Support-HTTP-Auth: fallback
</pre>
<p/>
<p id="rfc.section.2.1.2.3.p.5">If client authentication fails, the server MUST respond with an HTTP 401 unauthorized status code. In that case, a client which received the previous header should retry authenticating to the server without sending the "X-Support-HTTP-Auth: true" header.  </p>
<p id="rfc.section.2.1.2.3.p.6">Otherwise, on successful authentication the server should reply with a 200 HTTP code and use the 'complete' config-auth XML structure as in <a href="#authentication_cert">Section 2.1.2.1</a>.  </p>
<h1 id="rfc.section.2.1.3"><a href="#rfc.section.2.1.3">2.1.3.</a> <a href="#params-exchange" id="params-exchange">Exchange of Session Parameters</a></h1>
<p id="rfc.section.2.1.3.p.1">By the receipt of a success XML structure, the client SHOULD issue an HTTP CONNECT request. In addition it may provide the following headers.  </p>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Address-Type: A comma separated list of the requested address types.  <dl><dt></dt><dd style="margin-left: 8">IPv4: when the client only supports IPv4 addresses.</dd><dt></dt><dd style="margin-left: 8">IPv6: when the client only supports IPv6 addresses.</dd><dt></dt><dd style="margin-left: 8">IPv4,IPv6: when the client supports both types of IP addresses.</dd></dl><p> </p></dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Base-MTU: The MTU of the link as estimated by the client.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Accept-Encoding: A comma separated list of accepted compression algorithms for the CSTP channel.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">User-Agent: A string identifying the client software.</dd>
</dl>

<p> </p>
<p id="rfc.section.2.1.3.p.2">For the options related to compression see <a href="#compression">Appendix B</a> for more information.  </p>
<p id="rfc.section.2.1.3.p.3">An example CONNECT request is shown below.  </p>
<pre>
    User-Agent: Open AnyConnect VPN Agent v5.01
    X-CSTP-Base-MTU: 1280
    X-CSTP-Address-Type: IPv4,IPv6
    CONNECT /CSCOSSLC/tunnel HTTP/1.1
  </pre>
<p/>
<p id="rfc.section.2.1.3.p.5">After a successful receipt of an HTTP CONNECT request, the server should reply and provide the client with configuration parameters. The available options follow.  </p>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Address: The IPv4 address of the client, if IPv4 has been requested.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Netmask: An IPv4 netmask to be pushed to the client, if IPv4 has been requested. This should contain the mask on the P-t-P link and is RECOMMENDED the server address to be the first in defined network.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Address-IP6: The IPv6 address of the client in CIDR notation, if IPv6 has been requested. The prefix length is RECOMMENDED to be set to 127-bits according to <a href="#RFC6164">[RFC6164]</a>.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-DNS: The IP address of a DNS server that can be used for that session.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Default-Domain: The DNS domains the provided DNS servers respond for.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Split-Include: The network address of a route which is provided by this server.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Split-Exclude: The network address of a route that is not provided by this server.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Base-MTU: The MTU of the link as estimated by this server.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-DynDNS: Set to "true" if the server is operating with a dynamic DNS address.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-CSTP-Content-Encoding: if present is it set to one of the values presented by the client in 'X-CSTP-Accept-Encoding' header. It will be the compression algorithm used in the CSTP channel.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-Content-Encoding: if present is it set to one of the values presented by the client in 'X-DTLS-Accept-Encoding' header. It will be the compression algorithm used in the DTLS channel.</dd>
</dl>

<p> </p>
<p id="rfc.section.2.1.3.p.6">The client is expected to treat the received parameters as his networking settings. If no "X-CSTP-Split-Include" headers are present, the client is expected to assign its default route through the VPN.  </p>
<h1 id="rfc.section.2.1.4"><a href="#rfc.section.2.1.4">2.1.4.</a> <a href="#primary-channel" id="primary-channel">Establishment of Primary TCP Channel (CSTP)</a></h1>
<p id="rfc.section.2.1.4.p.1">The previous HTTP message is the last HTTP message sent by the server.  After that message, the established TCP channel is used to transport IP packets between the client and the server. The transferred packets encoding is discussed in <a href="#primary-channel-protocol">Section 2.2</a>. This channel will be referred as CSTP in the rest of this document.  </p>
<h1 id="rfc.section.2.1.5"><a href="#rfc.section.2.1.5">2.1.5.</a> <a href="#secondary-channel-establishment" id="secondary-channel-establishment">Establishment of Secondary UDP Channel (DTLS)</a></h1>
<p id="rfc.section.2.1.5.p.1">To establish the secondary UDP-based channel, which will be referred to as the DTLS channel, the client must advertise support for it during the issue of the HTTP CONNECT request (see <a href="#params-exchange">Section 2.1.3</a>. This is done by appending the following headers to the request.  </p>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-Accept-Encoding: A comma separated list of accepted compression algorithms for the DTLS channel.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-Master-Secret: A hex encoded pre-master secret to be used for the DTLS session.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-CipherSuite: A colon-separated list of ciphers (e.g., the string AES256-SHA:AES128-SHA:DES-CBC3-SHA).</dd>
</dl>

<p> </p>
<p id="rfc.section.2.1.5.p.2">The DTLS established DTLS channel utilizes session resumption as a method for preshared-key authentication. That is the value presented in X-DTLS-Master-Secret is set as a master secret to be resumed. The session ID value is sent by the server on the response to CONNECT using the 'X-DTLS-Session-ID' header. That header provides a hex-encoded value of the DTLS session ID to be used by the client. The following headers are used by the server's response to CONNECT, and are related to the DTLS channel establishment.  </p>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-Session-ID: A hex encoded value to be used as a DTLS session ID by the client. It also serves as an identifier for the server to associate the incoming DTLS session with the TLS session.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-Port: The port number to which the client should send UDP packets for DTLS.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-CipherSuite: The ciphersuite selected by the server. It should be one of the options present in the client's X-DTLS-CipherSuite header.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-Rekey-Time: The time (in seconds) after which the DTLS session should rekey, see <a href="#rekey-protocol">Section 2.4</a>.</dd>
  <dt></dt>
  <dd style="margin-left: 8">X-DTLS-Rekey-Method: The method used in DTLS rekey, see <a href="#rekey-protocol">Section 2.4</a>.</dd>
</dl>

<p> </p>
<p id="rfc.section.2.1.5.p.3">The following table lists the ciphers negotiated via the X-DTLS-CipherSuite header, and the corresponding DTLS ciphersuite.  </p>
<div id="rfc.table.1"/>
<div id="cipher_table"/>
<p/>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="center">OpenConnect cipher</th>
      <th class="center">DTLS ciphersuite</th>
      <th class="center">DTLS version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="center">DES-CBC3-SHA</td>
      <td class="center">TLS_RSA_WITH_3DES_EDE_CBC_SHA1</td>
      <td class="center">DTLS 0.9 (pre-draft version)</td>
    </tr>
    <tr>
      <td class="center">AES128-SHA</td>
      <td class="center">TLS_RSA_WITH_AES_128_CBC_SHA1</td>
      <td class="center">DTLS 0.9 (pre-draft version)</td>
    </tr>
    <tr>
      <td class="center">AES256-SHA</td>
      <td class="center">TLS_RSA_WITH_AES_256_CBC_SHA1</td>
      <td class="center">DTLS 0.9 (pre-draft version)</td>
    </tr>
    <tr>
      <td class="center">OC-DTLS1_2-AES128-GCM</td>
      <td class="center">TLS_RSA_WITH_AES_128_GCM_SHA256</td>
      <td class="center">DTLS 1.2</td>
    </tr>
    <tr>
      <td class="center">OC-DTLS1_2-AES256-GCM</td>
      <td class="center">TLS_RSA_WITH_AES_256_GCM_SHA256</td>
      <td class="center">DTLS 1.2</td>
    </tr>
  </tbody>
</table>
<p/>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#primary-channel-protocol" id="primary-channel-protocol">The CSTP Channel Protocol</a></h1>
<p id="rfc.section.2.2.p.1">The format of the packets sent over the primary channel consists of an 8-bytes header followed by data. The whole packet in encapsulated in a TLS record (see <a href="#RFC5246">[RFC5246]</a>). The bytes of the header indicate the type of data that follow, and their contents are explained in <a href="#cstp_table">Table 2</a>.  </p>
<div id="rfc.table.2"/>
<div id="cstp_table"/>
<p/>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="center">byte</th>
      <th class="left">value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="center">0</td>
      <td class="left">fixed to 0x53 (S)</td>
    </tr>
    <tr>
      <td class="center">1</td>
      <td class="left">fixed to 0x54 (T)</td>
    </tr>
    <tr>
      <td class="center">2</td>
      <td class="left">fixed to 0x46 (F)</td>
    </tr>
    <tr>
      <td class="center">3</td>
      <td class="left">fixed to 0x01</td>
    </tr>
    <tr>
      <td class="center">4-5</td>
      <td class="left">The length of the packet that follows this header in big endian order</td>
    </tr>
    <tr>
      <td class="center">6</td>
      <td class="left">The type of the payload that follows (see <a href="#packet_table">Table 3</a> for available types)</td>
    </tr>
    <tr>
      <td class="center">7</td>
      <td class="left">fixed to 0x00</td>
    </tr>
  </tbody>
</table>
<p/>
<p id="rfc.section.2.2.p.2">The available payload types are listed in <a href="#packet_table">Table 3</a>.  </p>
<div id="rfc.table.3"/>
<div id="packet_table"/>
<p/>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="center">Value</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="center">0x00</td>
      <td class="left">DATA: the TLS record packet contains an IPv4 or IPv6 packet</td>
    </tr>
    <tr>
      <td class="center">0x03</td>
      <td class="left">DPD-REQ: used for dead peer detection. Once sent the peer should reply with a DPD-RESP packet, that has the same contents as the original request.</td>
    </tr>
    <tr>
      <td class="center">0x04</td>
      <td class="left">DPD-RESP: used as a response to a previously received DPD-REQ.</td>
    </tr>
    <tr>
      <td class="center">0x05</td>
      <td class="left">DISCONNECT: sent by the client (or server) to terminate the session.  No data is associated with this request. The session will be invalidated after such request.</td>
    </tr>
    <tr>
      <td class="center">0x07</td>
      <td class="left">KEEPALIVE: sent by any peer. No data is associated with this request.</td>
    </tr>
    <tr>
      <td class="center">0x08</td>
      <td class="left">COMPRESSED DATA: a Data packet which is compressed prior to encryption.</td>
    </tr>
    <tr>
      <td class="center">0x09</td>
      <td class="left">TERMINATE: sent by the server to indicate that the server is shutting down. No data is associated with this request.</td>
    </tr>
  </tbody>
</table>
<p/>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#secondary-channel-protocol" id="secondary-channel-protocol">The DTLS Channel Protocol</a></h1>
<p id="rfc.section.2.3.p.1">The format of the packets sent over the UDP channel consists of an 1-byte header followed by data. The header byte indicates the type of data that follow as in <a href="#packet_table">Table 3</a>.  The header and the data are encapsulated in a DTLS record packet (see <a href="#RFC6347">[RFC6347]</a>).  </p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#rekey-protocol" id="rekey-protocol">The Channel Re-Key Protocol</a></h1>
<p id="rfc.section.2.4.p.1">During the exchange of session parameters (<a href="#params-exchange">Section 2.1.3</a>), the server advertizes the methods available for session rekey using the "X-CSTP-Rekey-Method" and "X-DTLS-Rekey-Method" HTTP headers. The available options for both the server and client are listed below.  </p>
<p/>

<ol>
  <li>none: no rekey; the session will go on until 2^48 DTLS records have been exchanged, or 2^64 TLS records.</li>
  <li>ssl: a TLS or DTLS rehandshake will be performed periodically.</li>
  <li>new-tunnel: the session will tear down and the client will reconnect periodically.</li>
</ol>

<p> </p>
<p id="rfc.section.2.4.p.3">When the value is other than "none" the rekey period is determinated by the "X-CSTP-Rekey-Time" and "X-DTLS-Rekey-Time" headers. These headers contain the time in seconds after which a session should rekey.  </p>
<p id="rfc.section.2.4.p.4">It should be noted that when the "ssl" rekey option is used, care must be taken by both the client and the server to ensure that either safe renegotiation is used (<a href="#RFC5746">[RFC5746]</a>), or that the identity of the peer remained the same.  </p>
<h1 id="rfc.section.2.5"><a href="#rfc.section.2.5">2.5.</a> <a href="#dead-peer-detection" id="dead-peer-detection">The Keepalive and Dead Peer Detection Protocols</a></h1>
<p id="rfc.section.2.5.p.1">In OpenConnect there are two packet types that can be used for keep-alive or dead peer detection, as shown in <a href="#packet_table">Table 3</a>. These are the DPD-REQ and KeepAlive packets.  </p>
<p id="rfc.section.2.5.p.2">The timings of the transmission of these packets are set by the server, and they for the DPD are advisory to a client. However, any peer receiving these packets MUST response with the appropriate packet. For DPD-REQ packets, the response MUST be DPD-RESP, and for KeepAlive packets the response must be another KeepAlive packet. The main difference between these two types of packets, is that the DPD packets similarly to <a href="#RFC3706">[RFC3706]</a> are sent when there is no traffic or when the other party requests them, and allow for arbitrary data to be attached, making them suitable for Path MTU detection.  </p>
<p id="rfc.section.2.5.p.3">The server advertizes the suggested periods during the exchange of session parameters (<a href="#params-exchange">Section 2.1.3</a>). The available headers are listed below.  </p>
<p/>

<ul class="empty">
  <li>X-CSTP-DPD: applicable to CSTP channel; contains a relative time in seconds.</li>
  <li>X-CSTP-Keepalive: applicable to CSTP channel; contains a relative time in seconds.</li>
  <li>X-DTLS-DPD: applicable to DTLS channel; contains a relative time in seconds.</li>
  <li>X-DTLS-Keepalive: applicable to DTLS channel; contains a relative time in seconds.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#security-analysis" id="security-analysis">Security Considerations</a></h1>
<p id="rfc.section.3.p.1">This document provides a description of a protocol to establish a VPN over a TLS channel. All security considerations of the referenced documents in particular <a href="#RFC5246">[RFC5246]</a> and <a href="#RFC6347">[RFC6347]</a> are applicable, in addition the following considerations.  </p>
<p id="rfc.section.3.p.2">The protocol is designed to be as compatible as possible with a legacy VPN protocol and as such it carries cruft, such as partial dependence on a non-standard DTLS version, and utilization of an awkward method to establish a DTLS session which relies on session resumption. Nevertheless, these particularities are not believed to cause a degradation of the overall protocol security, and could be addressed with a backwards compatible protocol upgrade.</p>
<p id="rfc.section.3.p.3">The protocol provides a VPN channel which carries payload hidden from eavesdroppers. However, the payload's length remain visible and in certain scenarios that may be sufficient to determine the transferred payload. Furthermore, there are scenarios where compressed payload lengths may reveal more information than the uncompressed data <a href="#COMP-ISSUES">[COMP-ISSUES]</a><a href="#COMP-ISSUES2">[COMP-ISSUES2]</a>.  For that we RECOMMEND that implementations don't enable compression by default, and only allow it after notifying the users and administrators about the consequences.  </p>
<p id="rfc.section.3.p.4">This protocol could sometimes be used because of the fact that it ressembles the TLS protocol and thus is not detected by the available VPN blockers. While an implementation could intentionally masquerade its packets to ressemble a typical HTTPS session, a fully compliant implementation will be distinct from an average HTTP session due to the DTLS session establishment, and the transferred packet sizes.  </p>
<p id="rfc.section.3.p.5">For certificate authentication OpenConnect relies on the TLS protocol. However, as mentioned in the text, TLS version 1.2 and earlier do not protect the client's (or the server's) certificate from eavesdroppers. For that it is RECOMMENDED that certificates to be used with this protocol contain the minimum possible identifying information.  </p>
<p id="rfc.section.3.p.6">This document defines a protocol name for Application-Layer Protocol Negotiation. That, if used by a client would indicate to any eavesdropping parties that the client wishes to use VPN, thus compromising its intention privacy. On the other hand, providing that information would help a server that re-uses the same port for different protocols under TLS, to forward to the appropriate handler of the connection. That is, it would allow hosting a plain HTTPS server serving content, and a VPN server using openconnect at the same port.  It is left to the client to decide the balance between privacy and usability with such servers.  </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Acknowledgements</h1>
<p id="rfc.section.4.p.1">None yet.  </p>
<h1 id="rfc.references"><a href="#rfc.references">5.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC5246">[RFC5246]</b>
      </td>
      <td class="top"><a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5746">[RFC5746]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, <a>Ray, M.</a>, <a>Dispensa, S.</a> and <a>N. Oskov</a>, "<a href="http://tools.ietf.org/html/rfc5746">Transport Layer Security (TLS) Renegotiation Indication Extension</a>", RFC 5746, February 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6347">[RFC6347]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc6347">Datagram Transport Layer Security Version 1.2</a>", RFC 6347, January 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2616">[RFC2616]</b>
      </td>
      <td class="top"><a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4559">[RFC4559]</b>
      </td>
      <td class="top"><a>Jaganathan, K.</a>, <a>Zhu, L.</a> and <a>J. Brezak</a>, "<a href="http://tools.ietf.org/html/rfc4559">SPNEGO-based Kerberos and NTLM HTTP Authentication in Microsoft Windows</a>", RFC 4559, June 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2743">[RFC2743]</b>
      </td>
      <td class="top"><a href="mailto:jlinn@rsasecurity.com" title="RSA Laboratories">Linn, J.</a>, "<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>", RFC 2743, January 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5056">[RFC5056]</b>
      </td>
      <td class="top"><a>Williams, N.</a>, "<a href="http://tools.ietf.org/html/rfc5056">On the Use of Channel Bindings to Secure Channels</a>", RFC 5056, November 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4519">[RFC4519]</b>
      </td>
      <td class="top"><a>Sciberras, A.</a>, "<a href="http://tools.ietf.org/html/rfc4519">Lightweight Directory Access Protocol (LDAP): Schema for User Applications</a>", RFC 4519, June 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6066">[RFC6066]</b>
      </td>
      <td class="top"><a>Eastlake, D.</a>, "<a href="http://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>", RFC 6066, January 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7301">[RFC7301]</b>
      </td>
      <td class="top"><a>Friedl, S.</a>, <a>Popov, A.</a>, <a>Langley, A.</a> and <a>E. Stephan</a>, "<a href="http://tools.ietf.org/html/rfc7301">Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension</a>", RFC 7301, July 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6164">[RFC6164]</b>
      </td>
      <td class="top"><a>Kohno, M.</a>, <a>Nitzan, B.</a>, <a>Bush, R.</a>, <a>Matsuzaki, Y.</a>, <a>Colitti, L.</a> and <a>T. Narten</a>, "<a href="http://tools.ietf.org/html/rfc6164">Using 127-Bit IPv6 Prefixes on Inter-Router Links</a>", RFC 6164, DOI 10.17487/RFC6164, April 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3706">[RFC3706]</b>
      </td>
      <td class="top"><a>Huang, G.</a>, <a>Beaulieu, S.</a> and <a>D. Rochefort</a>, "<a href="http://tools.ietf.org/html/rfc3706">A Traffic-Based Method of Detecting Dead Internet Key Exchange (IKE) Peers</a>", RFC 3706, DOI 10.17487/RFC3706, February 2004.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="COMP-ISSUES">[COMP-ISSUES]</b>
      </td>
      <td class="top"><a>Bhargavan, K.</a>, <a>Fournet, C.</a>, <a>Kohlweiss, M.</a>, <a>Pironti, A.</a> and <a>P-Y. Strub</a>, "<a>TLS Compression Fingerprinting and a Privacy-aware API for TLS</a>", 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="COMP-ISSUES2">[COMP-ISSUES2]</b>
      </td>
      <td class="top"><a>Kelsey, J.</a>, "<a>Compression  and  information  leakage  of plaintex</a>", International Workshop on Fast Software Encryption , 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OPENCONNECT-CLIENT">[OPENCONNECT-CLIENT]</b>
      </td>
      <td class="top"><a>Woodhouse, D.</a>, "<a>http://www.infradead.org/openconnect/</a>", 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OPENCONNECT-SERVER">[OPENCONNECT-SERVER]</b>
      </td>
      <td class="top"><a>Mavrogiannopoulos, N.</a>, "<a>http://www.infradead.org/ocserv/</a>", 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#alpn-name" id="alpn-name">Name for Application-Layer Protocol Negotiation</a></h1>
<pre>
   Protocol:  openconnect-vpn/1.0
   Identification Sequence:
           0x6f 0x70 0x65 0x6e 0x63 0x6f 0x6e 0x6e 0x65 0x63
           0x74 0x2d 0x76 0x70 0x6e 0x2f 0x31 0x2e 0x30
</pre>
<p/>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#compression" id="compression">Compression</a></h1>
<p id="rfc.section.B.p.1">The available compression algorithms for the CSTP and DTLS channels are shown in <a href="#compression_table">Table 4</a>. Note, that all algorithms are intentionally stateless to prevent the influence of independent packets (e.g., from different sources) on each others compression. That does not eliminate all known attacks on compression before encryption, and for that reason an implentation MUST NOT enable compression by default.  </p>
<p id="rfc.section.B.p.2">After compression is negotiated each side may choose to compress the payload and use the 'COMPRESSED DATA' header from <a href="#packet_table">Table 3</a>, or may send uncompressed data with the 'DATA' payload. Each side MUST be able to process both payloads.  </p>
<div id="rfc.table.4"/>
<div id="compression_table"/>
<p/>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="center">Algorithm</th>
      <th class="center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="center">oc-lz4</td>
      <td class="center">The stateless LZ4 compression algorithm.</td>
    </tr>
    <tr>
      <td class="center">lzs</td>
      <td class="center">The stateless LZS (stacker) compression algorithm.</td>
    </tr>
  </tbody>
</table>
<p/>
<h1 id="rfc.appendix.C"><a href="#rfc.appendix.C">Appendix C.</a> <a href="#dtd-decl" id="dtd-decl">DTD declarations</a></h1>
<h1 id="rfc.appendix.C.1"><a href="#rfc.appendix.C.1">C.1.</a> <a href="#dtd-decl1" id="dtd-decl1">config-auth.dtd</a></h1>
<pre>
&lt;!ELEMENT config-auth (version*,auth*)&gt;
  &lt;!ATTLIST config-auth client CDATA #FIXED "vpn"&gt;
  &lt;!ATTLIST config-auth type (init|auth-reply|auth-request|complete) "init"&gt;
&lt;!ELEMENT version (#PCDATA)&gt;
  &lt;!ATTLIST version who (sg|vpn) "sg"&gt;
&lt;!ELEMENT auth (title*,username*,password*,message*,form*)&gt;
  &lt;!ATTLIST auth id (success|main|failure) "failure"&gt;
  &lt;!ELEMENT title (#PCDATA)&gt;
  &lt;!ELEMENT username (#PCDATA)&gt;
  &lt;!ELEMENT password (#PCDATA)&gt;
  &lt;!ELEMENT message (#PCDATA)&gt;
  &lt;!ELEMENT form (input)&gt;
    &lt;!ATTLIST form action CDATA #FIXED "/auth"&gt;
    &lt;!ATTLIST form method CDATA #FIXED "post"&gt;
    &lt;!ELEMENT input (EMPTY)&gt;
       &lt;!ATTLIST input label CDATA ""&gt;
       &lt;!ATTLIST input name (username|password) "username"&gt;
       &lt;!ATTLIST input type (text|password) "text"&gt;
    &lt;!ELEMENT select (option)&gt;
       &lt;!ATTLIST select label CDATA ""&gt;
       &lt;!ATTLIST select name (group_list) "group_list"&gt;
    &lt;!ELEMENT option (#PCDATA)&gt;
</pre>
<p/>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Nikos Mavrogiannopoulos</span> 
	  <span class="n hidden">
		<span class="family-name">Mavrogiannopoulos</span>
	  </span>
	</span>
	<span class="org vcardline">Red Hat</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	
  </address>
</div>

</body>
</html>
